@using Microsoft.AspNetCore.Identity
@inject SignInManager<TaxDeclarationWeb.Models.ApplicationUser> SignInManager
@inject UserManager<TaxDeclarationWeb.Models.ApplicationUser> UserManager

@{
    string currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    string currentAction = ViewContext.RouteData.Values["action"]?.ToString();
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - TaxDeclaration</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <style>
        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        nav a {
            text-decoration: none;
        }

        .active {
            font-weight: bold;
            color: darkred;
        }
    </style>
</head>
<body>
<header>
    <nav>
        <ul>
            <li>
                <a asp-controller="Home" asp-action="Index"
                   class="@(currentController == "Home" ? "active" : "")">Главная</a>
            </li>

            @if (SignInManager.IsSignedIn(User))
            {
                var user = await UserManager.GetUserAsync(User);
                var roles = await UserManager.GetRolesAsync(user);

                if (roles.Contains("Admin"))
                {
                    <li>
                        <a asp-controller="Admin" asp-action="Index"
                           class="@(currentController == "Admin" ? "active" : "")">
                            Админ-панель
                        </a>
                    </li>
                }
                else if (roles.Contains("ChiefInspector"))
                {
                    <li>
                        <a asp-controller="ChiefInspector" asp-action="Index"
                           class="@(currentController == "ChiefInspector" ? "active" : "")">
                            Главный инспектор
                        </a>
                    </li>
                }
                else if (roles.Contains("Inspector"))
                {
                    <li>
                        <a asp-controller="Inspector" asp-action="Index"
                           class="@(currentController == "Inspector" ? "active" : "")">
                            Инспектор
                        </a>
                    </li>
                }
                else if (roles.Contains("Taxpayer"))
                {
                    <li>
                        <a asp-controller="Taxpayers" asp-action="Index"
                           class="@(currentController == "Taxpayer" ? "active" : "")">
                            Налогоплательщик
                        </a>
                    </li>
                }

                <li>
                    <a asp-controller="Account" asp-action="Logout">Выйти (@user.Email)</a>
                </li>
            }
            else
            {
                <li>
                    <a asp-controller="Account" asp-action="Login"
                       class="@(currentController == "Account" && currentAction == "Login" ? "active" : "")">
                        Вход
                    </a>
                </li>
            }
        </ul>
    </nav>
</header>

<main role="main" class="container">
    @RenderBody()
</main>

<footer>
    <p>&copy; @DateTime.Now.Year — TaxDeclaration</p>
</footer>
</body>
</html>
