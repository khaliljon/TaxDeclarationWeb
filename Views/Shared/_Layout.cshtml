@inherits Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
@using Microsoft.AspNetCore.Identity
@inject SignInManager<TaxDeclarationWeb.Models.ApplicationUser> SignInManager
@inject UserManager<TaxDeclarationWeb.Models.ApplicationUser> UserManager

@{
    string currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    string currentAction = ViewContext.RouteData.Values["action"]?.ToString();

    string userEmail = "";
    string userRole = "";

    if (SignInManager.IsSignedIn(User))
    {
        try
        {
            var userObj = await UserManager.GetUserAsync(User);
            if (userObj != null)
            {
                userEmail = userObj.Email;
                var roles = await UserManager.GetRolesAsync(userObj);
                userRole = roles.FirstOrDefault() ?? "";
            }
        }
        catch
        {
            userEmail = "Ошибка подключения к БД";
            userRole = "н/д";
        }
    }
}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - TaxDeclaration</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <style>
        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        nav a {
            text-decoration: none;
        }
        .active {
            font-weight: bold;
            color: darkred;
        }
        .user-info {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
<header>
    <nav>
        <ul>
            <li>
                <a asp-controller="Home" asp-action="Index"
                   class="@(currentController == "Home" ? "active" : "")">Главная</a>
            </li>

            @if (SignInManager.IsSignedIn(User))
            {
                if (User.IsInRole("Admin"))
                {
                    <li>
                        <a asp-controller="Admin" asp-action="Index"
                           class="@(currentController == "Admin" ? "active" : "")">Админ-панель</a>
                    </li>
                }
                if (User.IsInRole("ChiefInspector"))
                {
                    <li>
                        <a asp-controller="ChiefInspector" asp-action="Index"
                           class="@(currentController == "ChiefInspector" ? "active" : "")">Главный инспектор</a>
                    </li>
                }
                if (User.IsInRole("Inspector"))
                {
                    <li>
                        <a asp-controller="Inspectors" asp-action="Index"
                           class="@(currentController == "Inspectors" ? "active" : "")">Инспектор</a>
                    </li>
                }
                if (User.IsInRole("Taxpayer"))
                {
                    <li>
                        <a asp-controller="Taxpayer" asp-action="Index"
                           class="@(currentController == "Taxpayer" ? "active" : "")">Налогоплательщик</a>
                    </li>
                }
                <div class="user-info">
                    <span>👤 @userEmail</span>
                    @if (!string.IsNullOrEmpty(userRole))
                    {
                        <small style="color: gray">(@userRole)</small>
                    }
                    <form asp-controller="Account" asp-action="Logout" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-link" style="padding: 0; margin-left: 10px;">Выйти</button>
                    </form>
                </div>
            }
            else
            {
                <li>
                    <a asp-controller="Account" asp-action="Login"
                       class="@(currentController == "Account" && currentAction == "Login" ? "active" : "")">Вход</a>
                </li>
            }
        </ul>
    </nav>
</header>

<main role="main" class="container">
    @RenderBody()
</main>

<footer>
    <p>&copy; @DateTime.Now.Year — TaxDeclaration</p>
</footer>
@RenderSection("Scripts", required: false)
</body>
</html>
